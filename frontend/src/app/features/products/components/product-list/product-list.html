<div class="mb-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
  <button matButton="filled" routerLink="/products/new" class="w-full sm:w-auto">
    Add Product
  </button>

  <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4">
    <mat-form-field appearance="outline" class="w-full sm:w-56">
      <mat-label>Category</mat-label>
      <mat-select [value]="selectedCategory()" (selectionChange)="onCategoryChange($event.value)">
        @for (category of categories(); track category.id) {
        <mat-option [value]="category">
          {{ category.name }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>

    <button matButton class="w-full sm:w-auto" (click)="resetFilter()">Reset Filter</button>
  </div>
</div>

<div class="overflow-x-auto mat-elevation-z8 relative">
  @if (productsIsLoading()) {
  <mat-progress-bar mode="indeterminate" class="table-loader"></mat-progress-bar>
  }

  <table mat-table [dataSource]="products()" class="min-w-160 min-h-36 w-full">
    <ng-container matColumnDef="product">
      <th mat-header-cell *matHeaderCellDef>Product</th>
      <td mat-cell *matCellDef="let product">
        {{ product.name }}
      </td>
    </ng-container>

    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef>Price</th>
      <td mat-cell *matCellDef="let product">
        {{ product.price | currency : 'PHP' : 'symbol' : '1.2-2' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="category">
      <th mat-header-cell *matHeaderCellDef>Category</th>
      <td mat-cell *matCellDef="let product">
        {{ product.category.name }}
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let product">
        <div class="flex gap-2">
          <button
            matButton="filled"
            [routerLink]="['/products', product.id, 'edit']"
            [disabled]="deletingProductId() === product.id"
          >
            Edit
          </button>

          <button
            matButton="filled"
            class="warn-btn"
            (click)="confirmDelete(product)"
            [disabled]="deletingProductId() === product.id"
          >
            Delete
          </button>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      [ngClass]="{ 'disabled-row': deletingProductId() === row.id }"
    ></tr>
    @if(!productsIsLoading()) {
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" [attr.colspan]="displayedColumns.length">No products found.</td>
    </tr>
    }
  </table>
</div>
